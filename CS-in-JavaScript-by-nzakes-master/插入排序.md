# 插入排序
原文地址: [Computer science in JavaScript: Insertion sort](https://www.nczonline.net/blog/2012/09/17/computer-science-in-javascript-insertion-sort/)


在冒泡排序和选择排序之后，本系列将介绍第三种典型的排序算法－插入排序。插入排序在最佳情况下（best-case）复杂度为O(n),低于复杂度为O(n<sup>2</sup>)冒泡排序和选择排序。这也是本系列中所介绍的第一种稳定排序算法。

稳定排序是指不改变序列中相同元素的位置。在冒泡和选择排序中，可能会改变相同元素的原位置。你可能会好奇为什么需要关注相同元素的原位置。当对一些简单的值排序时，比如数字或字符串，这就无关紧要。可当我们排序的是带有属性的对象时，就会存在影响，比如对含有`age`属性的`person`对象排序，即使人名相同，但是年龄却有差别。

一些使用交换的排序算法自然而然就不是稳定排序。因为序列中的元素一直在移动，你无法保证其在原位置不变。插入排序并没有使用交换的方式，而是将每个单一的元素选出后再插入到序列中正确的位置。

插入排序的工作原理是将一个序列分成两个片段，一个已排序片段和一个为排序片段。当然，一开始整个序列都是未排序的。这时已排序片段为空。我们首先从待排序的序列中取第一个元素作为已排序片段的一个元素，这时候整个待排序的序列就变成了两部分，然后继续从未排序的片段中取出元素移动到已排序片段，操作如下：

- 如果从未排序片段取出的元素应该排在已排序片段的最后一个元素之后，那么不做任何操作。
- 如果取出的元素应该排在已排序片段最后一个元素之前，那么就将已排序片段的最后一个元素后移，空出位置供之前取出的元素插入。
- 该元素插入后继续与其前面的元素作比较
- 如果比较后该元素大于它前面的元素，那么插入完毕，否则将继续之前的操作直到该元素插入到正确的位置。

插入排序解释起来确实有点啰嗦（文字说明显得很抽象）， 可以用个简单的例子来说明，假设以下数组为待排序序列：

`var items = [5,2,6,1,3,9]`

首先将5作为已排序片段中第一个元素。然后开始操作2，由于5大于2，所以将5向右移动，将2放在第一个位置。该过程如下图所示（取出5之后待排序序列就变成了两个片段，黄色表示已排序片段，白色表示未排序片段）
![image](https://www.nczonline.net/images/wp-content/uploads/2012/09/insertionsort.png)

在这之后继续处理元素`6`。未排序片段中的每个元素都将执行以上操作直到每个元素都插入到正确的位置。JavaScript代码如下：


    function insertionSort(items) {
    var len     = items.length,     //待排序元素数量
        value,                      // 当前被比较的元素值
        i,                          // 未排序片段中的索引
        j;                          // 已经排序片段中的索引

    for (i=0; i < len; i++) {

        // 保存当前值以便后续移动
        value = items[i];

        /*
         *当已排序片段中的元素大于未排序片段中的值的时候
         *逐个移动已排序片段中的元素以便未排序片段中的元素插入正确的位置
         */
        for (j=i-1; j > -1 && items[j] > value; j--) {
            items[j+1] = items[j];
        }

        items[j+1] = value;
    }

    return items;
    }



外层`for`循环在未排序片段中从前往后遍历，内存`for`循环在已排序片段中从后往前遍历。内存循环同时负责在比较发生后移动元素。你可以从作者的Github上下载源码：[Computer Science in JavaScript](https://github.com/nzakas/computer-science-in-javascript/)

平均复杂度为O(n<sup>2</sup>)的插入排序效率并不高。在性能上它与选择和冒泡排序相当。这三个排序算法在此作为排序算法的讨论，在实际工作中可能不会用到。在JavaScript中实现排序最好的方法是在试用其他算法前使用自带的`Array.prototype.sort()`方法。Chrome的V8引擎在排序十个或者更少的元素时实际是使用插入排序来实现`Array.prototype.sort()`方法。
        
