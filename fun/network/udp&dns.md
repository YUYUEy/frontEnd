![udp头](http://pyblog-10073407.image.myqcloud.com/postimage1512823721?imageView2/0/w/450/h/400)  

上图可以看到udp的头和tcp相比很简单，和tcp一样有一个伪首部用来计算校验和。而且是将头部和数据都进行计算的  
这一点也和tcp一样，而ip首部的校验是只覆盖ip的头部的。  

udp只是在ip提供的数据包服务上添加了很少的复用 和 分用以及差错检测的功能。  

udp和tcp的区别主要是：  
1.一个面向数据报，一个面向字节流。  
2.一个是可靠的 一个是不可靠的。  
3.udp的头部开销小，并且不需要链接建立。在一些方面是更好的选择。  

因为在网络的底层有mtu的概念，在ip层会对数据进行分片。因为一个数据报在网络上是通过各个不同的子网络来传输的  
所以在这个过程中分片可能会进行多次。分片这件事在网络层来完成，对上层是透明的。  

最大的udp数据报的长度，理论上是65535（因为头部有一个长度的概念，最大16位），具体实现会因为一些其他原因有所不同。  
  

##### 之前看到的一个问题是 既然ip是无连接的 不可靠的，udp也是无连接的不可靠的，为什么要有udp的存在？  
按照我现在的理解 这里的答案主要就是因为ip层建立的是端到端的链接， 是两个主机间的。  
具体到执行的话是主机中的进程执行，而运输层的udp 和 tcp 都有端口这个概念。也就是依靠  
这个端口来执行具体的进程间的通信。也就是上面提到的复用 和 分用。  


### DNS域名系统  


DNS 指的是  ip地址---域名 之间的映射。因为ip地址记起来麻烦，没有域名直观，所以出现了dns来将两个地址绑定起来。  
我们在浏览器中输入一个地址中间都会使用到dns协议。  

DNS主要是通过udp来通信的，因为考虑到实时性，udp减少了建立链接的开销。dns支持递归和迭代两种查询方式。  
在一些大型网站中，通过dns可以将用户的请求解析到离用户近的地方，减少时延。还可以通过dns来实现负载均衡。  
  
#### 扩展 

**利用dns来解耦**  
试想有一种情况，内网中数据库都是在ip A上面的，现在ip要改为ip B， 怎么改？  

经常会出现一种情况就是牵一发而动全身，这样子改了在很多地方都需要修改一下，难免在一些地方会有  
遗漏，造成令人头疼的问题。  
解决方法也很简单，就是将内网的ip改为域名。修改如果要换一个新的ip就直接把新的ip对应到域名上就好了。  

在很多地方都有这种思路来解耦，比如flask框架中的url_for函数，如果不使用这个函数，而直接使用地址来写的话  
要修改的使用就很痛苦。 而通过url_for函数就可以将这个地址和函数绑定起来，这样就减少了耦合。  

#### httpdns？  
  
**域名缓存**  
1.localdns缓存了一些网站的解析结果，导致在请求的时候是直接返回，而不是向上层更权威的dns发起请求，  
导致可能该网站对应的ip地址已经改变，而用户拿到的还是旧的，然后无法进入网站。  
2.互联网接入运营商为了减少出口的带宽，降低成本，会在本网中使用缓存服务器，这样一些请求就只打到了本地的  
缓存服务器上面，整个流量只在本网内部消化。这样导致数据可能不是最新的。  
3.修改返回的内容，强行插入广告。这个应该是最无耻的行为了。   

**解析转发**  
上面提到了，dns的一个作用就是将不同地方用户的请求解析到离该地方最近的服务器上。 但是可能有这种问题，  
localdns为了减少流量，不向权威dns请求，而是转发到其他的localdns上，这就导致权威dns无法真正判断用户是那个地方  
的，返回的地址是一个错误的，然后用户访问速度会变慢。  

#### httpdns如何解决？  

**基本原理**  
A、客户端直接访问HttpDNS接口，获取业务在域名配置管理系统上配置的访问延迟最优的IP。（基于容灾考虑，还是保留次选使用运营商  
LocalDNS解析域名的方式）  

B、客户端向获取到的IP后就向直接往此IP发送业务协议请求。以Http请求为例，通过在header中指定host字段，向HttpDNS返回的IP发送  
标准的Http请求即可。



  





  






