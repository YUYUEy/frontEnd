 数据模型和查询语言。

数据模型是现在大多数应用的基石，这一点决定了我们如何设计相应的解决方案。使用的时候要能根据要解决的问题来选择合适的模型。

计算机系统中最重要的概念之一就是抽象，在数据模型这里是这样的：


	* 作为一个应用开发人员，要开发一个程序前，首先对现实世界进行一个建模。  
	* 保存数据的时候可以保存成xml json 或者关系数据库 文档数据库等
	* 设计数据库的工程师将上面的这些 xml/json/sql 等数据库实现出来， 要提供一种好的抽象来给人们使用
	* 数据库的最低一层就是和硬件打交道的，考虑的是数据如何保存在硬件上面。



在程序语言中是这样子的：   


	* 应用开发 使用python java 这些高级语言
	* C语言这种低级语言实现 上面的高级语言
	* 汇编来实现C语言
	* 机器语言来实现汇编


在网络中是这样子的：      


	* 应用层（给应用提供接口 例如 http ）
	* 传输层  （提供进程和进程间可靠的传输）
	* 网络层  （提供端到端不可靠的传输）
	* 链路层   （将有差错的物理线路改进为无差错的数据链路，向网络层提供高质量的数据传输服务。）
	* 物理层  （传输介质）


网络中有一个 SAP（服务访问点），两层之间通过这个逻辑接口来交互，这样的好处是在本层使用的时候只需要考虑自己的上下层。  在数据系统，程序语言也是如此，    
在使用的时候不需要关心太底层的东西，明白自己下一层次的原理，将提供的接口用好就可以了。



关系型数据库和文档型数据库。

其实文档型的数据库也是很早之前就出来了，只不过是当时的应用特点决定了关系型数据库是更好的选择。《现代操作系统》 中有一句话就是讲这方面的东西，讲为什么老技术又被用起来了。主要原因就是技术的变化是很快的，可能因为一些限制，现在的技术就被淘汰了，然后过几年随着需求的变化，这种技术又要被重新使用。搞明白为什么有的技术会被重新启用，为什么有的技术会被淘汰是很重要的。

多对一 和 多对多

很多时候在数据库中保存的是一个 链接的id。 通过这个id去获取具体的要显示的信息。 而不是直接保存具体的文本信息。     
在前端使用的时候通常是通过列表 或者自动填充器来进行选择。
这样的好处是：


	* 将一些字段进行标准化
	* 避免歧义（比如同名的城市）
	* 这些数据只保存在一个表中，修改的时候只需要修改一个表就好了
	* 如果要通过一个城市的所有用户，通过这种方式也很容易。


规范化 和 非规范化    

规范化就是减少数据的冗余，查询可能会变得麻烦。
非规范化的话允许冗余，但是查询会很方便。
比如 保存一个文章的标签，非规范化的话就是将这些保存在一个列表中，获取文章的时候就直接获取到了。 而规范化的话就需要再去    
查询另一个表。


例子： 在一个简历上加一个推荐功能， 这个推荐上面需要添加推荐人的照片和姓名。 当推荐人照片更新了，这个更新后的照片应该能够及时
展示在推荐中，这种情况下应该引用作者的个人资料。  实现思路就是   推荐语+作者的链接

下图是将简历中加入这个推荐语的功能。 虚线内的是一个文档，将 学校，单位，其它用户变为引用。
这样做的好处是 这几个信息都是有很多用户共用的，  如果学校，或者单位信息要修改的话会很容易。
同时查询一个学校的学生，一个公司的同事会很方便。



文档型数据库和关系型数据库的主要区别。     

![区别](http://pyblog-10073407.image.myqcloud.com/postimage1520148862?imageView2/0/w/450/h/400 "enter image title here")

关系型数据库的优点


	* 结构化数据
	* 关系型数据
	* 需要复杂的联结操作
	* 事务
	* 清晰的扩展模式
	* 既有资源更丰富：开发者、社区、代码库、工具等
	* 通过索引进行查询非常快

文档数据库的优点


	* 半结构化数据
	* 动态或灵活的模式
	* 非关系型数据
	* 不需要复杂的联结操作
	* 存储 TB （甚至 PB）级别的数据
	* 高数据密集的工作负载
	* 高吞吐量


之前看很多资料中讲到 文档数据库很大的一个特点是 scheme free。 作者在这里指出这个术语不够精确，更好的解释应该是 schema-on-read      
数据在读取的时候获取类型。 这一点也类似于程序语言中的动态语言。 也正式因为这一点 文档数据库会灵活很多。

在要改变数据格式的时候  写时模式（传统数据库）模式变更比较慢一点，可能需要停机。 在这一点 文档型的数据库的优势就出来了。

用什么数据模型？     

如果应用的数据类似于文档，没有被拆为多个的话使用文档数据库是很好的选择。 如果数据是被拆开了，数据间有很多关系，    
并且有强一致性要求的话就要使用关系数据库。 如果数据之间的联系特别多 关系模型勉强可用。图形模型是最好的选择。


查询的数据局部性

如果程序用到的数据经常是一大块的，存储局部性会有性能优势， 查询的速度就会快很多。
 反之如果数据在不同的地方 查找的时候就要 进行多次查找，总的查找性能会慢很多。

但是数据如果只被用到一小部分，就不值得使用 局部性了，在更新的时候需要整个重写，不合算。


现在常用的文档数据库和关系数据库的很多功能已经重合了，文档数据库支持 将多个表链接在一起操作。      
关系数据库开始支持更多的数据类型。


ORM  对象关系映射

由于现在开发程序使用的都是面向对象的语言，而sql 的思路是声明式的。两者有很大的区别，为了减少这个区别就出现了ORM，     
用来将sql转化为对象来使用。

在python中常用的orm是 sqlachemy。 做的事情不只是进行一层映射，还会自动进行一些优化。


数据查询

声明式查询

sql 是声明式的。 而我们常用的都是命令式的。 区别如下

有这样的一个表，表中的数据是这样子的
有三列数据 name age location

查询所有名字为 jack的信息

命令式
req = []
for user in table:
    if user.name == ‘jack’:
        req.append(user)
return req

或
在python中

     [i for i in table if i.name==‘jack' ]

     filter(lambda x: x.name==‘jack’, table)

声明式

     select * from table where name = jack

声明式查询的时候查询优化器会自动选择使用那些索引。
并且声明式的语言对并行支持很好。 命令式 它指定了必须以特定顺序执行的指令，很难被并行化。
在这个摩尔定律失效的时候，单个cpu增长已经到了极限，性能提升全靠增加核心数。这一点上
声明式有很大优势。

在web中的xpath同样也是声明式的。如果要用命令式的来写会很痛苦。

mapreduce 

主要思路就是将任务拆分开。 举例来说就是军训时候统计各个方块的人数。 每一个方块统计自己方块的人数这就是map。     
最后汇总起来就是reduce。


链接

[文档数据库的使用](https://www.yunxcloud.cn/post/159)    

[声明式编程相关](https://www.yunxcloud.cn/post/185)

[为什么声明式比命令式可以更好的并行化](https://www.zhihu.com/question/268062648) 

Todo

图数据库


















